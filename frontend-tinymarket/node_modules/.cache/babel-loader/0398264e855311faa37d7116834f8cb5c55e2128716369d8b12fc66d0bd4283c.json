{"ast":null,"code":"import { createFetchFn } from '@stacks/network';\nimport { parseZoneFile } from 'zone-file';\nimport { getTokenFileUrl, Person } from '../profile';\nimport { extractProfile } from '../profileTokens';\nexport function resolveZoneFileToPerson(zoneFile, publicKeyOrAddress, callback, fetchFn = createFetchFn()) {\n  let zoneFileJson = null;\n  try {\n    zoneFileJson = parseZoneFile(zoneFile);\n    if (!zoneFileJson.hasOwnProperty('$origin')) {\n      zoneFileJson = null;\n      throw new Error('zone file is missing an origin');\n    }\n  } catch (e) {\n    console.error(e);\n  }\n  let tokenFileUrl = null;\n  if (zoneFileJson && Object.keys(zoneFileJson).length > 0) {\n    tokenFileUrl = getTokenFileUrl(zoneFileJson);\n  } else {\n    let profile = null;\n    try {\n      profile = JSON.parse(zoneFile);\n      const person = Person.fromLegacyFormat(profile);\n      profile = person.profile();\n    } catch (error) {\n      console.warn(error);\n    }\n    callback(profile);\n    return;\n  }\n  if (tokenFileUrl) {\n    fetchFn(tokenFileUrl).then(response => response.text()).then(responseText => JSON.parse(responseText)).then(responseJson => {\n      const tokenRecords = responseJson;\n      const token = tokenRecords[0].token;\n      const profile = extractProfile(token, publicKeyOrAddress);\n      callback(profile);\n    }).catch(error => {\n      console.warn(error);\n    });\n  } else {\n    console.warn('Token file url not found');\n    callback({});\n  }\n}","map":{"version":3,"names":["createFetchFn","parseZoneFile","getTokenFileUrl","Person","extractProfile","resolveZoneFileToPerson","zoneFile","publicKeyOrAddress","callback","fetchFn","zoneFileJson","hasOwnProperty","Error","e","console","error","tokenFileUrl","Object","keys","length","profile","JSON","parse","person","fromLegacyFormat","warn","then","response","text","responseText","responseJson","tokenRecords","token","catch"],"sources":["C:\\Users\\user\\Documents\\Tiny-Market\\frontend-tinymarket\\node_modules\\@stacks\\profile\\src\\profileSchemas\\personZoneFiles.ts"],"sourcesContent":["// @ts-ignore: Could not find a declaration file for module\r\nimport { createFetchFn, FetchFn } from '@stacks/network';\r\nimport { parseZoneFile } from 'zone-file';\r\n\r\nimport { getTokenFileUrl, Person } from '../profile';\r\nimport { extractProfile } from '../profileTokens';\r\n\r\n/**\r\n *\r\n * @param zoneFile\r\n * @param publicKeyOrAddress\r\n * @param callback\r\n *\r\n * @ignore\r\n */\r\nexport function resolveZoneFileToPerson(\r\n  zoneFile: any,\r\n  publicKeyOrAddress: string,\r\n  callback: (profile: any) => void,\r\n  fetchFn: FetchFn = createFetchFn()\r\n) {\r\n  let zoneFileJson = null;\r\n  try {\r\n    zoneFileJson = parseZoneFile(zoneFile);\r\n    if (!zoneFileJson.hasOwnProperty('$origin')) {\r\n      zoneFileJson = null;\r\n      throw new Error('zone file is missing an origin');\r\n    }\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n\r\n  let tokenFileUrl = null;\r\n  if (zoneFileJson && Object.keys(zoneFileJson).length > 0) {\r\n    tokenFileUrl = getTokenFileUrl(zoneFileJson);\r\n  } else {\r\n    let profile = null;\r\n    try {\r\n      profile = JSON.parse(zoneFile);\r\n      const person = Person.fromLegacyFormat(profile);\r\n      profile = person.profile();\r\n    } catch (error) {\r\n      console.warn(error);\r\n    }\r\n    callback(profile);\r\n    return;\r\n  }\r\n\r\n  if (tokenFileUrl) {\r\n    fetchFn(tokenFileUrl)\r\n      .then(response => response.text())\r\n      .then(responseText => JSON.parse(responseText))\r\n      .then(responseJson => {\r\n        const tokenRecords = responseJson;\r\n        const token = tokenRecords[0].token;\r\n        const profile = extractProfile(token, publicKeyOrAddress);\r\n\r\n        callback(profile);\r\n      })\r\n      .catch(error => {\r\n        console.warn(error);\r\n      });\r\n  } else {\r\n    console.warn('Token file url not found');\r\n    callback({});\r\n  }\r\n}\r\n"],"mappings":"AACA,SAASA,aAAa,QAAiB,iBAAiB;AACxD,SAASC,aAAa,QAAQ,WAAW;AAEzC,SAASC,eAAe,EAAEC,MAAM,QAAQ,YAAY;AACpD,SAASC,cAAc,QAAQ,kBAAkB;AAUjD,OAAM,SAAUC,uBAAuBA,CACrCC,QAAa,EACbC,kBAA0B,EAC1BC,QAAgC,EAChCC,OAAA,GAAmBT,aAAa,EAAE;EAElC,IAAIU,YAAY,GAAG,IAAI;EACvB,IAAI;IACFA,YAAY,GAAGT,aAAa,CAACK,QAAQ,CAAC;IACtC,IAAI,CAACI,YAAY,CAACC,cAAc,CAAC,SAAS,CAAC,EAAE;MAC3CD,YAAY,GAAG,IAAI;MACnB,MAAM,IAAIE,KAAK,CAAC,gCAAgC,CAAC;;GAEpD,CAAC,OAAOC,CAAC,EAAE;IACVC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC;;EAGlB,IAAIG,YAAY,GAAG,IAAI;EACvB,IAAIN,YAAY,IAAIO,MAAM,CAACC,IAAI,CAACR,YAAY,CAAC,CAACS,MAAM,GAAG,CAAC,EAAE;IACxDH,YAAY,GAAGd,eAAe,CAACQ,YAAY,CAAC;GAC7C,MAAM;IACL,IAAIU,OAAO,GAAG,IAAI;IAClB,IAAI;MACFA,OAAO,GAAGC,IAAI,CAACC,KAAK,CAAChB,QAAQ,CAAC;MAC9B,MAAMiB,MAAM,GAAGpB,MAAM,CAACqB,gBAAgB,CAACJ,OAAO,CAAC;MAC/CA,OAAO,GAAGG,MAAM,CAACH,OAAO,EAAE;KAC3B,CAAC,OAAOL,KAAK,EAAE;MACdD,OAAO,CAACW,IAAI,CAACV,KAAK,CAAC;;IAErBP,QAAQ,CAACY,OAAO,CAAC;IACjB;;EAGF,IAAIJ,YAAY,EAAE;IAChBP,OAAO,CAACO,YAAY,CAAC,CAClBU,IAAI,CAACC,QAAQ,IAAIA,QAAQ,CAACC,IAAI,EAAE,CAAC,CACjCF,IAAI,CAACG,YAAY,IAAIR,IAAI,CAACC,KAAK,CAACO,YAAY,CAAC,CAAC,CAC9CH,IAAI,CAACI,YAAY,IAAG;MACnB,MAAMC,YAAY,GAAGD,YAAY;MACjC,MAAME,KAAK,GAAGD,YAAY,CAAC,CAAC,CAAC,CAACC,KAAK;MACnC,MAAMZ,OAAO,GAAGhB,cAAc,CAAC4B,KAAK,EAAEzB,kBAAkB,CAAC;MAEzDC,QAAQ,CAACY,OAAO,CAAC;IACnB,CAAC,CAAC,CACDa,KAAK,CAAClB,KAAK,IAAG;MACbD,OAAO,CAACW,IAAI,CAACV,KAAK,CAAC;IACrB,CAAC,CAAC;GACL,MAAM;IACLD,OAAO,CAACW,IAAI,CAAC,0BAA0B,CAAC;IACxCjB,QAAQ,CAAC,EAAE,CAAC;;AAEhB"},"metadata":{},"sourceType":"module","externalDependencies":[]}